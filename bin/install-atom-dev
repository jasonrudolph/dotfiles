#!/usr/bin/env bash
#
# Download and install the latest Atom dev release for macOS (i.e., the latest
# successful build from Atom's master branch).
#
# Courtesy of https://github.com/as-cii ðŸŒŸ

set -e

GREEN='\033[0;32m'
NC='\033[0m' # No Color

atom_zipped_path=$(mktemp)
atom_unzipped_parent_path=$(mktemp -d)
function cleanup {
  echo -e "${GREEN}Cleaning up${NC}"
  rm -rf $atom_zipped_path
  rm -rf $atom_unzipped_parent_path
}
trap cleanup EXIT

echo -e "${GREEN}Downloading latest Atom dev release${NC}"
curl --location https://atom.io/download/mac?channel=dev > $atom_zipped_path

echo -e "${GREEN}Unzipping downloaded artifact${NC}"
unzip -qq $atom_zipped_path -d $atom_unzipped_parent_path

echo -e "${GREEN}Replacing existing Atom installation${NC}"
rm -rf /Applications/Atom.app
mv $atom_unzipped_parent_path/Atom.app /Applications/Atom.app
